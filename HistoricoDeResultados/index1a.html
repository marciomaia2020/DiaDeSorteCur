<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Histórico de Resultados Dia de Sorte - Visualização e Estatísticas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
        }
    
        h3 {
            margin: 0 0 10px;
            font-size: 1.2em;
            color: #555;
        }
    
        .stats-box {
            background: #fff;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }
    
        .number-stat,
        .month-stat,
        .quadrant-stat {
            background: #f1f1f1;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            font-size: 0.9em;
        }
    
        .number-stat span:first-child {
            display: block;
            font-weight: bold;
            color: #333;
        }
    
        .number-stat span:last-child {
            color: #777;
        }
    
        #statsSection {
            padding: 20px;
            max-width: 900px;
            margin: auto;
        }
    
        #loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
            color: #555;
        }
    
        #loading.active {
            display: block;
        }
    
        button {
            background: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px;
        }
    
        button:disabled {
            background: #bbb;
            cursor: not-allowed;
        }
    
        #error {
            color: #d9534f;
            text-align: center;
            margin-top: 10px;
        }
    </style>
    
</head>
<body>
    <div class="container">
        <h2>Histórico de Resultados Dia de Sorte</h2>
        <button id="loadResults">Carregar Resultados</button>

        <div id="statsSection" class="stats-container"></div>
        <div id="loading" class="loading">Carregando resultados...</div>
        <div id="error" class="error"></div>
        <div id="results"></div>
    </div>

<script>
let currentConcurso = 1;
let isLoading = false;
let maxConcurso = 750; // Estimativa para Dia de Sorte
let globalStats = {
    numbers: Array(31).fill(0), // Contagem dos 31 números
    months: Array(12).fill(0), // Contagem dos 12 meses
    totalGames: 0,
    sequences: 0,
    oddEven: { odd: 0, even: 0 },
    sum: 0,
    totalNumbers: 0,
    quadrants: Array(8).fill(0) // Contagem dos 8 quadrantes
};

function getQuadrantForNumber(number) {
    if (number <= 4) return 1;       // Quadrante 1
    if (number <= 8) return 2;       // Quadrante 2
    if (number <= 12) return 3;      // Quadrante 3
    if (number <= 16) return 4;      // Quadrante 4
    if (number <= 20) return 5;      // Quadrante 5
    if (number <= 24) return 6;      // Quadrante 6
    if (number <= 28) return 7;      // Quadrante 7
    return 8;                        // Quadrante 8 (29, 30, 31)
}

function updateStats(dezenas, mesSorte) {
    globalStats.totalGames++;

    dezenas.forEach(num => {
        globalStats.numbers[num - 1]++;
        const quadrant = getQuadrantForNumber(num);
        globalStats.quadrants[quadrant - 1]++; // Atualiza o quadrante

        if (num % 2 === 0) {
            globalStats.oddEven.even++;
        } else {
            globalStats.oddEven.odd++;
        }
    });

    globalStats.months[mesSorte - 1]++;

    globalStats.sum += dezenas.reduce((a, b) => a + b, 0);
    globalStats.totalNumbers += dezenas.length;

    const sortedDezenas = [...dezenas].sort((a, b) => a - b);
    for (let i = 0; i < sortedDezenas.length - 1; i++) {
        if (sortedDezenas[i + 1] - sortedDezenas[i] === 1) {
            globalStats.sequences++;
            break;
        }
    }

    renderStats();
}

function renderStats() {
    const statsSection = document.getElementById('statsSection');
    statsSection.innerHTML = '';

    // Estatísticas dos Números
    const numberStats = document.createElement('div');
    numberStats.className = 'stats-box';
    const topNumbers = globalStats.numbers
        .map((count, idx) => ({ number: idx + 1, count }))
        .sort((a, b) => b.count - a.count)
        .slice(0, 10);

    numberStats.innerHTML = `
        <h3>Top 10 Números Mais Sorteados</h3>
        ${topNumbers.map(({ number, count }) => `
            <div class="number-stat">
                <span>Número ${number}</span>
                <span>${count} vezes (${((count / globalStats.totalGames) * 100).toFixed(1)}%)</span>
            </div>
        `).join('')}
    `;

    // Estatísticas dos Quadrantes
    const quadrantStats = document.createElement('div');
    quadrantStats.className = 'stats-box';
    quadrantStats.innerHTML = `
        <h3>Frequência por Quadrante</h3>
        <div class="stats-grid">
            ${globalStats.quadrants.map((count, idx) => `
                <div class="quadrant-stat">
                    Quadrante ${idx + 1}: ${count} vezes
                </div>
            `).join('')}
        </div>
    `;

    // Estatísticas dos Meses da Sorte
    const monthStats = document.createElement('div');
    monthStats.className = 'stats-box';
    monthStats.innerHTML = `
        <h3>Frequência dos Meses de Sorte</h3>
        <div class="stats-grid">
            ${globalStats.months.map((count, idx) => `
                <div class="month-stat">
                    ${new Date(0, idx).toLocaleString('pt-BR', { month: 'long' })}: ${count}
                </div>
            `).join('')}
        </div>
    `;

    statsSection.appendChild(numberStats);
    statsSection.appendChild(quadrantStats);
    statsSection.appendChild(monthStats);
}

async function fetchSingleResult(concurso) {
    const url = `https://loteriascaixa-api.herokuapp.com/api/diadesorte/${concurso}`;
    const response = await fetch(url);

    if (!response.ok) {
        if (response.status === 404) {
            return null;
        }
        throw new Error(`HTTP error! status: ${response.status}`);
    }

    return await response.json();
}

async function fetchAllResults() {
    if (isLoading) return;

    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const loadInitialButton = document.getElementById('loadResults');
    
    isLoading = true;
    loading.classList.add('active');
    loadInitialButton.disabled = true;
    error.textContent = '';

    try {
        while (currentConcurso <= maxConcurso) {
            const data = await fetchSingleResult(currentConcurso);

            if (!data) break;

            const dezenas = data.dezenas.map(Number);
            const mesSorte = Number(data.mesSorte);
            updateStats(dezenas, mesSorte);

            currentConcurso++;
        }
    } catch (err) {
        error.textContent = 'Erro ao buscar os resultados. Tente novamente mais tarde.';
        console.error(err);
    } finally {
        loading.classList.remove('active');
        loadInitialButton.disabled = false;
        isLoading = false;
    }
}




document.getElementById('loadResults').addEventListener('click', fetchAllResults);

</script>
</body>
</html>
