<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Histórico de Resultados Dia de Sorte - Visualização e Estatísticas</title>
    <style>
    /* Estilos ajustados conforme as cores desejadas */
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0; /* Cor de fundo */
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .container {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        max-width: 1000px;
        width: 100%;
        text-align: center;
    }

    .result {
        margin-bottom: 30px;
        display: inline-block;
        width: 100%;
    }

    .result h3 {
        margin-bottom: 15px;
        font-size: 16px;
        text-align: center;
    }

    .quadrant-grid {
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        grid-template-rows: repeat(6, 1fr);
        gap: 5px;
        margin: 0 auto;
        max-width: 500px;
        background-color: #ffffff;
        padding: 15px;
    }

    .number {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-weight: normal;
        font-size: 14px;
        background-color: #d4f3e3;
        color: #333;
        border: none;
        width: 100%;
        height: 100%;
        min-width: 35px;
        min-height: 35px;
        position: relative;
    }

    .quadrant1 { background-color: #D1B513; }
    .quadrant2 { background-color: #FFDD55; }
    .quadrant3 { background-color: #FFD700; }
    .quadrant4 { background-color: #FFF7A5; }

    .highlight {
        background-color: #0d904f !important;
        color: white;
    }

    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
        margin-bottom: 20px;
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 8px;
        text-align: left;
    }

    .stats-box {
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stats-box h3 {
        color: #0D904F;
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 18px;
        text-align: center;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
        margin-bottom: 15px;
    }

    .quadrant-stat {
        padding: 8px;
        border-radius: 4px;
        text-align: center;
        font-size: 0.6em;
        gap: 10px;
    }

    .number-stat {
        display: flex;
        justify-content: space-between;
        padding: 4px 0;
        border-bottom: 1px solid #eee;
    }

    .loading {
        display: none;
        margin: 20px 0;
    }

    .loading.active {
        display: block;
    }

    .error {
        color: red;
        margin-top: 10px;
    }

    button {
        padding: 10px 20px;
        background-color: #b6a022; /* Cor de fundo do botão */
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-bottom: 20px;
        font-size: 16px;
    }

    button:hover {
        background-color: #D1B513;
    }

    button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
    }

    .game-container {
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        background-color: #fff;
    }

    span {
        font-weight: normal;
        font-size: 18px;
    }

    #progressBar {
        width: 100%;
        height: 20px;
        margin-bottom: 10px;
    }
    
    .centralizado {
        text-align: center;
        font-size: 12px;
        color: blue;
    }

    /* Adicionando estilos adicionais para os quadrantes */
    .quadrant1, .quadrant2, .quadrant3, .quadrant4 {
        background-color: #D1B513;
        font-weight: bold;
        color: #fff;
        text-align: center;
    }

    /* Outros estilos mantidos igual */
    </style>
</head>
<body>
    <div class="container">
        <header class="header-section">
            <h2>Histórico de Resultados Dia de Sorte</h2>
            <div class="centralizado">
                <p>Quadrantes <b><u>com estatísticas</u></b></p>
            </div>
        </header>
    
        <section class="controls-section">
            <button id="loadResults" class="load-button">Carregar Resultados</button>
            <div class="progress-container">
                <progress id="progressBar" max="100" value="0"></progress>
                <span id="progressLabel" class="progress-label">0%</span>
            </div>
        </section>
    
        <section class="results-container">
            <div id="loading" class="loading">Carregando resultados...</div>
            <div id="error" class="error"></div>
            
            <div id="statsSection" class="stats-container sticky">
                <!-- Estatísticas serão inseridas aqui -->
            </div>
    
            <div id="results" class="results-scroll"></div>
        </section>
    
        <footer class="feedback-section">
            <div id="feedback" class="feedback"></div>
        </footer>
    </div>

<script>
// Script permanece o mesmo
    let currentConcurso = 1;
    let isLoading = false;
    let maxConcurso = 2600;
    let globalStats = {
        quadrants: Array(4).fill(0),
        numbers: Array(31).fill(0),
        totalGames: 0,
        sequences: 0,
        oddEven: { odd: 0, even: 0 },
        sum: 0,
        totalNumbers: 0
    };

    // Funções auxiliares mantidas iguais
    function getQuadrantClass(number) {
        if ([1, 2, 11, 12, 21, 22, 31].includes(number)) return 'quadrant1';
        if ([3, 4, 5, 13, 14, 15, 23, 24, 25].includes(number)) return 'quadrant2';
        if ([6, 7, 8, 16, 17, 18, 26, 27, 28].includes(number)) return 'quadrant3';
        if ([9, 10, 19, 20, 29, 30].includes(number)) return 'quadrant4';
    }

    function getQuadrantForNumber(number) {
        if ([1, 2, 11, 12, 21, 22, 31].includes(number)) return 1;
        if ([3, 4, 5, 13, 14, 15, 23, 24, 25].includes(number)) return 2;
        if ([6, 7, 8, 16, 17, 18, 26, 27, 28].includes(number)) return 3;
        if ([9, 10, 19, 20, 29, 30].includes(number)) return 4;
    }

    function updateStats(dezenas) {
        globalStats.totalGames++;

        dezenas.forEach(num => {
            const quadrant = getQuadrantForNumber(num);
            globalStats.quadrants[quadrant - 1]++;
            globalStats.numbers[num - 1]++;

            if (num % 2 === 0) {
                globalStats.oddEven.even++;
            } else {
                globalStats.oddEven.odd++;
            }
        });

        globalStats.sum += dezenas.reduce((a, b) => a + b, 0);
        globalStats.totalNumbers += dezenas.length;

        const sortedDezenas = [...dezenas].sort((a, b) => a - b);
        for (let i = 0; i < sortedDezenas.length - 1; i++) {
            if (sortedDezenas[i + 1] - sortedDezenas[i] === 1) {
                globalStats.sequences++;
                break;
            }
        }
    }

    function renderStats() {
        const statsSection = document.getElementById('statsSection');
        statsSection.innerHTML = '';

        const quadrantStats = document.createElement('div');
        quadrantStats.className = 'stats-box';
        quadrantStats.innerHTML = `
            <h3>Frequência por Quadrante</h3>
            <div class="stats-grid">
                ${globalStats.quadrants.map((count, idx) => `
                    <div class="quadrant-stat quadrant${idx + 1}">
                        Q${idx + 1}<br>
                        ${count} (${((count / globalStats.totalNumbers) * 100).toFixed(1)}%)
                    </div>
                `).join('')}
            </div>
        `;

        const numberStats = document.createElement('div');
        numberStats.className = 'stats-box';
        const topNumbers = globalStats.numbers
            .map((count, idx) => ({number: idx + 1, count}))
            .sort((a, b) => b.count - a.count)
            .slice(0, 10);
        
        numberStats.innerHTML = `
            <h3>Top 10 Números Mais Sorteados</h3>
            ${topNumbers.map(({number, count}) => `
                <div class="number-stat">
                    <span>Número ${number}</span>
                    <span>${count} vezes (${((count / globalStats.totalGames) * 100).toFixed(1)}%)</span>
                </div>
            `).join('')}
        `;

        const generalStats = document.createElement('div');
        generalStats.className = 'stats-box';
        generalStats.innerHTML = `
            <h3>Estatísticas Gerais</h3>
            <div class="number-stat">
                <span>Total de Jogos:</span>
                <span>${globalStats.totalGames}</span>
            </div>
            <div class="number-stat">
                <span>Média da Soma:</span>
                <span>${(globalStats.sum / globalStats.totalGames).toFixed(1)}</span>
            </div>
            <div class="number-stat">
                <span>Números Pares:</span>
                <span>${((globalStats.oddEven.even / globalStats.totalNumbers) * 100).toFixed(1)}%</span>
            </div>
            <div class="number-stat">
                <span>Números Ímpares:</span>
                <span>${((globalStats.oddEven.odd / globalStats.totalNumbers) * 100).toFixed(1)}%</span>
            </div>
            <div class="number-stat">
                <span>Jogos com Sequências:</span>
                <span>${((globalStats.sequences / globalStats.totalGames) * 100).toFixed(1)}%</span>
            </div>
        `;

        statsSection.appendChild(quadrantStats);
        statsSection.appendChild(numberStats);
        statsSection.appendChild(generalStats);
    }

    function renderResults(dezenas, concurso) {
        const resultsDiv = document.getElementById('results');

        const resultEntry = document.createElement('div');
        resultEntry.classList.add('result');
        resultEntry.innerHTML = `
            <h3>Concurso ${concurso}</h3>
            <div class="quadrant-grid">
                ${Array.from({length: 31}, (_, i) => i + 1).map(num => `
                    <div class="number ${getQuadrantClass(num)} ${dezenas.includes(num) ? 'highlight' : ''}">
                        ${num}
                    </div>
                `).join('')}
            </div>
        `;
        
        resultsDiv.insertBefore(resultEntry, resultsDiv.firstChild);
    }

    async function fetchSingleResult(concurso) {
        const url = `https://loteriascaixa-api.herokuapp.com/api/diadesorte/${concurso}`;
        try {
            const response = await fetch(url);
            if (!response.ok) {
                if (response.status === 404) {
                    console.error('Concurso não encontrado:', concurso);
                    return null;
                }
                throw new Error('Erro ao buscar resultados');
            }
            const data = await response.json();
            return data.numeros ? data.numeros.map(Number) : null;
        } catch (error) {
            console.error('Erro:', error);
            return null;
        }
    }

    async function loadResults() {
        if (isLoading) return;
        isLoading = true;
        
        document.getElementById('loading').classList.add('active');
        document.getElementById('error').innerHTML = '';
        document.getElementById('feedback').innerHTML = '';
        document.getElementById('results').innerHTML = '';

        let successCount = 0;
        let errorCount = 0;

        const delay = ms => new Promise(resolve => setTimeout(resolve, ms));

        for (let concurso = currentConcurso; concurso <= maxConcurso; concurso++) {
            try {
                const dezenas = await fetchSingleResult(concurso);
                
                if (dezenas) {
                    updateStats(dezenas);
                    renderResults(dezenas, concurso);
                    renderStats();
                    successCount++;
                } else {
                    errorCount++;
                }

                const progressPercentage = (concurso / maxConcurso) * 100;
                document.getElementById('progressBar').value = progressPercentage;
                document.getElementById('progressLabel').innerText = `${Math.round(progressPercentage)}%`;

                // Adiciona um pequeno atraso para permitir a atualização da UI
                await delay(100);
            } catch (error) {
                console.error(error);
                errorCount++;
            }
        }

        document.getElementById('loading').classList.remove('active');
        document.getElementById('feedback').innerHTML = `
            <p><strong>Carregamento concluído!</strong></p>
            <p>Resultados carregados com sucesso: ${successCount}</p>
            <p>Falhas: ${errorCount}</p>
        `;
        
        isLoading = false;
    }

    document.getElementById('loadResults').addEventListener('click', () => {
        if (!isLoading) {
            currentConcurso = 1;
            maxConcurso = 2600;
            globalStats = {
                quadrants: Array(4).fill(0),
                numbers: Array(31).fill(0),
                totalGames: 0,
                sequences: 0,
                oddEven: { odd: 0, even: 0 },
                sum: 0,
                totalNumbers: 0
            };
            loadResults();
        }
    });

</script>
</body>
</html>
